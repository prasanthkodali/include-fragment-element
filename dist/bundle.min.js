var _IncludeFragmentElement_instances,_IncludeFragmentElement_busy,_IncludeFragmentElement_observer,_IncludeFragmentElement_handleData,_IncludeFragmentElement_getData,_IncludeFragmentElement_getStringOrErrorData,_IncludeFragmentElement_task,_IncludeFragmentElement_fetchDataWithEvents,__defProp=Object.defineProperty,__name=(e,t)=>__defProp(e,"name",{value:t,configurable:!0}),__classPrivateFieldGet=function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},__classPrivateFieldSet=function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},privateData=new WeakMap;function isWildcard(e){return e&&!!e.split(",").find((e=>e.match(/^\s*\*\/\*/)))}__name(isWildcard,"isWildcard");var cspTrustedTypesPolicyPromise=null,IncludeFragmentElement=class extends HTMLElement{constructor(){super(...arguments),_IncludeFragmentElement_instances.add(this),_IncludeFragmentElement_busy.set(this,!1),_IncludeFragmentElement_observer.set(this,new IntersectionObserver((e=>{for(const t of e)if(t.isIntersecting){const{target:e}=t;if(__classPrivateFieldGet(this,_IncludeFragmentElement_observer,"f").unobserve(e),!(e instanceof IncludeFragmentElement))return;"lazy"===e.loading&&__classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_handleData).call(this)}}),{rootMargin:"0px 0px 256px 0px",threshold:.01}))}static define(e="include-fragment",t=customElements){return t.define(e,this),this}static setCSPTrustedTypesPolicy(e){cspTrustedTypesPolicyPromise=null===e?e:Promise.resolve(e)}static get observedAttributes(){return["src","loading"]}get src(){const e=this.getAttribute("src");if(e){const t=this.ownerDocument.createElement("a");return t.href=e,t.href}return""}set src(e){this.setAttribute("src",e)}get loading(){return"lazy"===this.getAttribute("loading")?"lazy":"eager"}set loading(e){this.setAttribute("loading",e)}get accept(){return this.getAttribute("accept")||""}set accept(e){this.setAttribute("accept",e)}get data(){return __classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_getStringOrErrorData).call(this)}attributeChangedCallback(e,t){"src"===e?this.isConnected&&"eager"===this.loading&&__classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_handleData).call(this):"loading"===e&&this.isConnected&&"eager"!==t&&"eager"===this.loading&&__classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_handleData).call(this)}connectedCallback(){if(!this.shadowRoot){this.attachShadow({mode:"open"});const e=document.createElement("style");e.textContent=":host {display: block;}",this.shadowRoot.append(e,document.createElement("slot"))}this.src&&"eager"===this.loading&&__classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_handleData).call(this),"lazy"===this.loading&&__classPrivateFieldGet(this,_IncludeFragmentElement_observer,"f").observe(this)}request(){const e=this.src;if(!e)throw new Error("missing src");return new Request(e,{method:"GET",credentials:"same-origin",headers:{Accept:this.accept||"text/html"}})}load(){return __classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_getStringOrErrorData).call(this)}fetch(e){return fetch(e)}refetch(){privateData.delete(this),__classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_handleData).call(this)}};__name(IncludeFragmentElement,"IncludeFragmentElement"),_IncludeFragmentElement_busy=new WeakMap,_IncludeFragmentElement_observer=new WeakMap,_IncludeFragmentElement_instances=new WeakSet,_IncludeFragmentElement_handleData=__name((async function(){if(!__classPrivateFieldGet(this,_IncludeFragmentElement_busy,"f")){__classPrivateFieldSet(this,_IncludeFragmentElement_busy,!0,"f"),__classPrivateFieldGet(this,_IncludeFragmentElement_observer,"f").unobserve(this);try{const e=await __classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_getData).call(this);if(e instanceof Error)throw e;const t=e,n=document.createElement("template");n.innerHTML=t;const a=document.importNode(n.content,!0);if(!this.dispatchEvent(new CustomEvent("include-fragment-replace",{cancelable:!0,detail:{fragment:a}})))return void __classPrivateFieldSet(this,_IncludeFragmentElement_busy,!1,"f");this.replaceWith(a),this.dispatchEvent(new CustomEvent("include-fragment-replaced"))}catch(e){this.classList.add("is-error")}finally{__classPrivateFieldSet(this,_IncludeFragmentElement_busy,!1,"f")}}}),"_IncludeFragmentElement_handleData"),_IncludeFragmentElement_getData=__name((async function(){const e=this.src,t=privateData.get(this);if(t&&t.src===e)return t.data;{let t;return t=e?__classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_fetchDataWithEvents).call(this):Promise.reject(new Error("missing src")),privateData.set(this,{src:e,data:t}),t}}),"_IncludeFragmentElement_getData"),_IncludeFragmentElement_getStringOrErrorData=__name((async function(){const e=await __classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_getData).call(this);if(e instanceof Error)throw e;return e.toString()}),"_IncludeFragmentElement_getStringOrErrorData"),_IncludeFragmentElement_task=__name((async function(e){await new Promise((e=>setTimeout(e,0)));for(const t of e)this.dispatchEvent(new Event(t))}),"_IncludeFragmentElement_task"),_IncludeFragmentElement_fetchDataWithEvents=__name((async function(){try{await __classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_task).call(this,["loadstart"]);const e=await this.fetch(this.request());if(200!==e.status)throw new Error(`Failed to load resource: the server responded with a status of ${e.status}`);const t=e.headers.get("Content-Type");if(!(isWildcard(this.accept)||t&&t.includes(this.accept?this.accept:"text/html")))throw new Error(`Failed to load resource: expected ${this.accept||"text/html"} but was ${t}`);const n=await e.text();let a=n;if(cspTrustedTypesPolicyPromise){a=(await cspTrustedTypesPolicyPromise).createHTML(n,e)}return __classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_task).call(this,["load","loadend"]),a}catch(e){throw __classPrivateFieldGet(this,_IncludeFragmentElement_instances,"m",_IncludeFragmentElement_task).call(this,["error","loadend"]),e}}),"_IncludeFragmentElement_fetchDataWithEvents");var root="undefined"!=typeof globalThis?globalThis:window;try{root.IncludeFragmentElement=IncludeFragmentElement.define()}catch(e){if(!(root.DOMException&&e instanceof DOMException&&"NotSupportedError"===e.name||e instanceof ReferenceError))throw e}var dist_default=IncludeFragmentElement;export{IncludeFragmentElement,dist_default as default};
